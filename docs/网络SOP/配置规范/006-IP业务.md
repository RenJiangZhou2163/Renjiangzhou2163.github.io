
## 1.6 IP业务

### 1.6.1 IP性能配置的配置规范

#### 1.6.1.1 TCP window-size配置规范

由于TCP提供收发缓冲区进行报文缓存，如果配置的收发缓冲区过小，导致设备无法收发超过该大小的报文，可能导致TCP连接中断。

##### 应用场景

部署使用TCP进行建连的业务，例如BGP、LDP等。

##### 配置规范

在系统视图下，执行**tcp window** *window-size*命令，将TCP收发缓冲区大小调整为一个合理的值。

##### 非规范配置的风险

**风险描述**

- 在系统视图下，执行**tcp window** *window-size*命令，设置TCP收发缓冲区大小。例如，设置**tcp window** **1**将TCP的收发缓冲区设置为1K字节。
- 使用TCP的业务收发的报文超过TCP收发缓冲区大小。例如，上述配置条件下，使用TCP的业务收发的报文超过1K字节。

满足上述所有条件时，TCP连接中断，从而影响到使用该TCP的业务转发。

业务现象：

TCP连接中断。

**风险的判断方法**

在用户视图下，执行**display tcp status**命令，查看TCP连接状态。

连接正常时，可以看到对应的TCP连接存在。

```
<HUAWEI> display tcp status
TCPCB    Tid/Soid Local Add:port        Foreign Add:port      VPNID  State
7800b1ec 6  /1    0.0.0.0:21            0.0.0.0:0             23553  Listening
72094f08 144/4    0.0.0.0:22            0.0.0.0:0             23553  Listening
78000714 144/1    0.0.0.0:23            0.0.0.0:0             23553  Listening
7800a90c 175/3    0.0.0.0:179           1.1.1.1:0     0      Listening
7208f1d8 175/6    0.0.0.0:179           1.1.1.2:0       0      Listening
7374df44 175/327  2.2.2.2:54269         3.3.3.3:179     0      Syn_Sent
12d26d68 144/6    192.168.131.166:23     192.168.224.3:57582    0      Established
15691498 144/29   192.168.131.166:23     192.168.224.3:61044    0      Established
7375240c 144/23   192.168.131.166:23     192.168.242.37:50132   0      Established
12d23a60 144/5    192.168.131.166:23     192.168.242.37:54566   0      Established
7374bbc4 144/30   192.168.131.166:23     192.168.250.23:8426    0      Established
7067cff4 175/10   192.168.131.166:179    192.168.242.37:54512   0      Established
```

连接中断后，查看不到对应的TCP连接存在。

```
<HUAWEI> display tcp status
TCPCB    Tid/Soid Local Add:port        Foreign Add:port      VPNID  State
7800b1ec 6  /1    0.0.0.0:21            0.0.0.0:0             23553  Listening
72094f08 144/4    0.0.0.0:22            0.0.0.0:0             23553  Listening
78000714 144/1    0.0.0.0:23            0.0.0.0:0             23553  Listening
7800a90c 175/3    0.0.0.0:179           1.1.1.1:0     0      Listening
7208f1d8 175/6    0.0.0.0:179           1.1.1.2:0       0      Listening
7374df44 175/327  2.2.2.2:54269         3.3.3.3:179     0      Syn_Sent
```

**风险的恢复方案**

请按照配置规范进行配置。

### 1.6.2 IPv6基础配置的配置规范

#### 1.6.2.1 TCP6 window-size配置规范

由于TCP6提供收发缓冲区进行报文缓存，如果配置的收发缓冲区过小，导致设备无法收发超过该大小的报文，可能导致TCP6连接中断。

##### 应用场景

部署使用TCP6进行建连的业务，例如BGP、LDP等。

##### 配置规范

在系统视图下，执行**tcp ipv6 window** *window-size*命令，将TCP6收发缓冲区大小调整为一个合理的值。

##### 非规范配置的风险

**风险描述**

- 在系统视图下，执行**tcp ipv6 window** *window-size*命令，设置TCP6收发缓冲区大小。例如，设置**tcp ipv6 window** **1**将TCP6的收发缓冲区设置为1K字节。
- 使用TCP6的业务收发的报文超过TCP6收发缓冲区大小。例如，上述配置条件下，使用TCP6的业务收发的报文超过1K字节。

满足上述所有条件时，TCP6连接中断，从而影响到使用该TCP6的业务转发。

业务现象如下：

TCP6连接中断。

**风险的判断方法**

在用户视图下，执行**display tcp ipv6 status**命令，查看TCP6连接状态。

连接正常时，可以看到对应的TCP6连接存在。

```
<HUAWEI> display tcp ipv6 status
* - MD5 Authentication is enabled.
# - Keychain Authentication is enabled.
TCP6CB TID/SoID  Local Address        Foreign Address      State        VPNID
78004bdc 144/3     ::->22               ::->0                Listening    23553
78000dbc 144/2     ::->23               ::->0                Listening    23553
12d26d68 144/6    2000::1->23          2000::2->57582       Established  0
```

连接中断后，查看不到对应的TCP6连接存在。

```
<HUAWEI> display tcp ipv6 status
* - MD5 Authentication is enabled.
# - Keychain Authentication is enabled.
TCP6CB TID/SoID  Local Address        Foreign Address      State        VPNID
78004bdc 144/3     ::->22               ::->0                Listening    23553
78000dbc 144/2     ::->23               ::->0                Listening    23553
```

**风险的恢复方案**

请按照配置规范进行配置。
